#!/usr/bin/env python
# -*- coding: latin-1 -*-

import sys

translation_iso2tex = {
    "ä": "\\\"a",
    "à": "\\`a",
    "á": "\\'a",
    "ã": "\\~a",
    "â": "\\^a",
    "ë": "\\\"e",
    "è": "\\`e",
    "é": "\\'e",
    "ê": "\\^e",
    "ï": "\\\"\\i",
    "ì": "\\`\\i",
    "í": "\\'\\i",
    "î": "\\^\\i",
    "ö": "\\\"o",
    "ò": "\\`o",
    "ó": "\\'o",
    "õ": "\\~o",
    "ô": "\\^o",
    "ü": "\\\"",
    "ù": "\\`u",
    "ú": "\\'u",
    "û": "\\^u",
    "Ä": "\\\"A",
    "À": "\\`A",
    "Á": "\\'A",
    "Ã": "\\~A",
    "Â": "\\^A",
    "Ë": "\\\"E",
    "È": "\\`E",
    "É": "\\'E",
    "Ê": "\\^E",
    "Ï": "\\\"I",
    "Ì": "\\`I",
    "Í": "\\'I",
    "Î": "\\^I",
    "Ö": "\\\"O",
    "Ò": "\\`O",
    "Ó": "\\'O",
    "Õ": "\\~O",
    "Ô": "\\^O",
    "Ü": "\\\"U",
    "Ù": "\\`U",
    "Ú": "\\'U",
    "Û": "\\^U",
    "ñ": "\\~n",
    "Ñ": "\\~N",
    "ç": "\\c c",
    "Ç": "\\c C",
    "£": "\\pounds"
}

translation_tex2iso = {
    "{\\\"a}": "ä",
    "{\\`a}": "à",
    "{\\'a}": "á",
    "{\\~a}": "ã",
    "{\\^a}": "â",
    "{\\\"e}": "ë",
    "{\\`e}": "è",
    "{\\'e}": "é",
    "{\\^e}": "ê",
    "{\\\"\\i}": "ï",
    "{\\`\\i}": "ì",
    "{\\'\\i}": "í",
    "{\\^\\i}": "î",
    "{\\\"i}": "ï",
    "{\\`i}": "ì",
    "{\\'i}": "í",
    "{\\^i}": "î",
    "{\\\"o}": "ö",
    "{\\`o}": "ò",
    "{\\'o}": "ó",
    "{\\~o}": "õ",
    "{\\^o}": "ô",
    "{\\\"u}": "ü",
    "{\\`u}": "ù",
    "{\\'u}": "ú",
    "{\\^u}": "û",
    "{\\\"A}": "Ä",
    "{\\`A}": "À",
    "{\\'A}": "Á",
    "{\\~A}": "Ã",
    "{\\^A}": "Â",
    "{\\\"E}": "Ë",
    "{\\`E}": "È",
    "{\\'E}": "É",
    "{\\^E}": "Ê",
    "{\\\"I}": "Ï",
    "{\\`I}": "Ì",
    "{\\'I}": "Í",
    "{\\^I}": "Î",
    "{\\\"O}": "Ö",
    "{\\`O}": "Ò",
    "{\\'O}": "Ó",
    "{\\~O}": "Õ",
    "{\\^O}": "Ô",
    "{\\\"U}": "Ü",
    "{\\`U}": "Ù",
    "{\\'U}": "Ú",
    "{\\^U}": "Û",
    "{\\~n}": "ñ",
    "{\\~N}": "Ñ",
    "{\\c c}": "ç",
    "{\\c C}": "Ç",
    "\\\"a": "ä",
    "\\`a": "à",
    "\\'a": "á",
    "\\~a": "ã",
    "\\^a": "â",
    "\\\"e": "ë",
    "\\`e": "è",
    "\\'e": "é",
    "\\^e": "ê",
    "\\\"i": "ï",
    "\\`i": "ì",
    "\\'i": "í",
    "\\^i": "î",
    "\\\"o": "ö",
    "\\`o": "ò",
    "\\'o": "ó",
    "\\~o": "õ",
    "\\^o": "ô",
    "\\\"u": "ü",
    "\\`u": "ù",
    "\\'u": "ú",
    "\\^u": "û",
    "\\\"A": "Ä",
    "\\`A": "À",
    "\\'A": "Á",
    "\\~A": "Ã",
    "\\^A": "Â",
    "\\\"E": "Ë",
    "\\`E": "È",
    "\\'E": "É",
    "\\^E": "Ê",
    "\\\"I": "Ï",
    "\\`I": "Ì",
    "\\'I": "Í",
    "\\^I": "Î",
    "\\\"O": "Ö",
    "\\`O": "Ò",
    "\\'O": "Ó",
    "\\~O": "Õ",
    "\\^O": "Ô",
    "\\\"U": "Ü",
    "\\`U": "Ù",
    "\\'U": "Ú",
    "\\^U": "Û",
    "\\~n": "ñ",
    "\\~N": "Ñ",
    "\\\"{a}": "ä",
    "\\`{a}": "à",
    "\\'{a}": "á",
    "\\~{a}": "ã",
    "\\^{a}": "â",
    "\\\"{e}": "ë",
    "\\`{e}": "è",
    "\\'{e}": "é",
    "\\^{e}": "ê",
    "\\\"{\\i}": "ï",
    "\\`{\\i}": "ì",
    "\\'{\\i}": "í",
    "\\^{\\i}": "î",
    "\\\"{i}": "ï",
    "\\`{i}": "ì",
    "\\'{i}": "í",
    "\\^{i}": "î",
    "\\\"{o}": "ö",
    "\\`{o}": "ò",
    "\\'{o}": "ó",
    "\\~{o}": "õ",
    "\\^{o}": "ô",
    "\\\"{u}": "ü",
    "\\`{u}": "ù",
    "\\'{u}": "ú",
    "\\^{u}": "û",
    "\\\"{A}": "Ä",
    "\\`{A}": "À",
    "\\'{A}": "Á",
    "\\~{A}": "Ã",
    "\\^{A}": "Â",
    "\\\"{E}": "Ë",
    "\\`{E}": "È",
    "\\'{E}": "É",
    "\\^{E}": "Ê",
    "\\\"{I}": "Ï",
    "\\`{I}": "Ì",
    "\\'{I}": "Í",
    "\\^{I}": "Î",
    "\\\"{O}": "Ö",
    "\\`{O}": "Ò",
    "\\'{O}": "Ó",
    "\\~{O}": "Õ",
    "\\^{O}": "Ô",
    "\\\"{U}": "Ü",
    "\\`{U}": "Ù",
    "\\'{U}": "Ú",
    "\\^{U}": "Û",
    "\\~{n}": "ñ",
    "\\~{N}": "Ñ",
    "\\c{c}": "ç",
    "\\c{C}": "Ç",
    }

# Create decoded dictionnaries
translation_iso2tex_decoded = dict()
translation_tex2iso_decoded = dict()
for i, j in translation_iso2tex.iteritems():
    translation_iso2tex_decoded[i.decode('latin1')] = j.decode('latin1')
for i, j in translation_tex2iso.iteritems():
    translation_tex2iso_decoded[i.decode('latin1')] = j.decode('latin1')


if len(sys.argv) != 3:
    sys.stderr.writelines((
        "Usage: texaccents enc conversion < input > output\n",
        "\tenc is the encoding of the file (latin1 or utf8)\n",
        "\tconversion can be iso2tex or tex2iso\n"))
    exit()
else:
    encoding = sys.argv[1]
    if sys.argv[2] == "iso2tex":
        translation_table = translation_iso2tex_decoded
    elif sys.argv[2] == "tex2iso":
        translation_table = translation_tex2iso_decoded
    else:
        sys.stderr.writelines((
            "Usage: texaccents conversion < input > output\n",
            "conversion can be iso2tex or tex2iso\n"))
        exit()


for line in sys.stdin:
    line = line.decode(encoding)
    for i, j in translation_table.iteritems():
        line = line.replace(i, j)
    print line.encode(encoding),
